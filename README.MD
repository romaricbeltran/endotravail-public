# ğŸ® Endo'travail â€“ Serious Game sur l'EndomÃ©triose au Travail (Unity)

Endo'Travail est un jeu narratif construit pour sensibiliser Ã  l'endomÃ©triose en entreprise. Le jeu combine des sÃ©quences narratives, des missions interactives en vue TPS, des choix impactant la progression, et des contenus pÃ©dagogiques validÃ©s juridiquement et scientifiquement.

## âš ï¸ Contenus manquants dans ce dÃ©pÃ´t

Par respect du droit d'auteur :
- Pas de contenus narratifs (ScriptableObjects) d'EndoFrance
- Pas d'assets 3D du bureau Unity Asset Store

Pour exÃ©cuter le projet :
1. CrÃ©ez vos propres ScriptableObjects
2. IntÃ©grez votre propre environnement 3D
3. Adaptez les systÃ¨mes Ã  votre propre scÃ©nario

## ğŸ“– Contexte

65 % des personnes atteintes dâ€™endomÃ©triose reconnaissent un impact nÃ©gatif de la maladie sur leur quotidien professionnel selon lâ€™enquÃªte Endovie IPSOS Gederon Richter EndoFrance en janvier 2020.

Ainsi, nous avons crÃ©Ã© â€œEndoâ€™travailâ€, le serious game qui lÃ¨ve les tabous sur lâ€™endomÃ©triose au travail !

Ce jeu a pour objectif de sensibiliser les salariÃ©Â·eÂ·s, les managers, et la Direction Ã  lâ€™impact de lâ€™endomÃ©triose sur le quotidien professionnel. Il dÃ©crit quelques situations rencontrÃ©es par des personnes menstruÃ©es atteintes dâ€™endomÃ©triose dans le cadre du travail. Il donne Ã©galement des pistes pour vous aider Ã  trouver des solutions. Les scÃ©narios ont Ã©tÃ© relus et validÃ©s par une Avocate en droit du travail et un MÃ©decin du travail.

Avertissement : Toute ressemblance avec la vie rÃ©elle est complÃ¨tement prÃ©mÃ©ditÃ©e et basÃ©e sur lâ€™expertise dâ€™EndoFrance et les tÃ©moignages de personnes atteintes dâ€™endomÃ©triose. Bien Ã©videmment, ce serious game ne peut pas Ãªtre exhaustif. Chaque cas dâ€™endomÃ©triose est unique et chaque situation personnelle, professionnelle aussi.


## ğŸ§  Vue d'ensemble technique

- Moteur de narration modulaire basÃ© sur des ScriptableObjects
- Architecture orientÃ©e Ã©vÃ©nements (Observer, State, Command, Factory, Strategy)
- SÃ©quence de gameplay contrÃ´lÃ©e via Timeline avec signaux et Cinemachine
- SystÃ¨me de flags narratifs avec pondÃ©ration et transitions dynamiques
- TPS jouable avec triggers physiques
- AccessibilitÃ© pensÃ©e dÃ¨s la conception pour un public large (jouable sur navigateur web et mobile, contrÃ´les optimisÃ©s...)

## ğŸ—ï¸ Architecture modulaire : NÅ“uds, Managers, Timeline

### ğŸ”¹ NÅ“uds narratifs typÃ©s
Chaque chapitre est un ScriptableObject contenant une liste typÃ©e de nÅ“uds :

- **Dialogue** : texte + audio
- **Popup** : contenu pÃ©dagogique
- **Choice** : embranchements conditionnels
- **Mission** : TPS interactif
- Chaque nÅ“ud peut embarquer un **Badge** (rÃ©compense)

### ğŸ”¹ TimelineManager : orchestrateur central

Lecture de chaque nÅ“ud via :
- Chargement du manager (via LoadActionManager() â€“ IActionManager â†’ BaseActionManager<T>)
- DÃ©clenchement Timeline : clip avec signaux Unity pour synchroniser contenu + dÃ©clenchements prÃ©cis
- ExÃ©cution logique mÃ©tier via StartAction(), puis EndAction() â†’ transition au nÅ“ud suivant

### ğŸ”¹ SystÃ¨me de Flags narratifs

Les Flags permettent :
- De contrÃ´ler les embranchements (via conditions sur les nÅ“uds ou les choix)
- De sauvegarder l'Ã©tat narratif
- De pondÃ©rer les fins et scÃ©narios selon les choix (logique de score, cohÃ©rence, retours dynamiquesâ€¦)

## ğŸ§¬ Design Architecture â€“ Extensible & SOLID

### âš™ï¸ SystÃ¨me de gestion des actions (IActionManager)

Le systÃ¨me repose sur trois couches modulaires :
- IActionManager : interface dÃ©finissant le contrat d'action (exÃ©cution, complÃ©tion, retour Ã  la missionâ€¦)
- BaseActionManager\<T> : classe abstraite gÃ©rant les Ã©lÃ©ments communs (cycle de vie, data binding, transitionsâ€¦)
- Managers spÃ©cialisÃ©s : hÃ©ritent de BaseActionManager et gÃ¨rent uniquement leur logique mÃ©tier spÃ©cifique

```csharp unity
public class DialogueActionManager : BaseActionManager<DialogueAction> {
  public override void LoadAction(DialogueAction currentAction) {
    // Prepare content
  }
  
  public override void StartAction() {
    // Display & action
  }

  public override void EndAction() {
    // Hide & clean
  }
}
```

### ğŸ”„ Cycle de vie d'un nÅ“ud narratif

1. TimelineManager charge le chapitre et le nÅ“ud courant
2. Appel de LoadActionManager() pour instancier le bon manager
3. Le TimelineClip dÃ©clenche le StartAction() via un signal
4. Interaction utilisateur â†’ traitement
5. EndAction() est appelÃ© â†’ transition automatique au nÅ“ud suivant

## ğŸ—ºï¸ Arbre Narratif & Embranchements

### ğŸ” Logique de navigation en condition et prioritÃ©

1. `HandleFlaggedNodes` â†’ navigation dans une branche sÃ©lectionnÃ©e dynamiquement ou saut narratif selon la cohÃ©rence et le poids des choix passÃ©s (on prend le flag avec le plus de points)
2. Si null, `FindScenarioNodeByName` â†’ navigation vers le noeud choisi par le joueur (Choice) ou trigger lors d'une mission (composition de Mission)
3. Si null, `GetNextNodeInBranchOrScenario` â†’ navigation sÃ©quentielle et en remontant au parent jusqu'Ã  la fin de chapitre

Permet de gÃ©rer :
- Branches scÃ©naristiques cohÃ©rentes
- Fins alternatives selon les parcours
- Retours dynamiques en cas de boucle ou d'embranchement spÃ©cial (ux-friendly)

## ğŸ§© Types d'Actions â€“ Zoom sur la logique mÃ©tier

### ğŸ™ï¸ Dialogue
- Affichage progressif du texte et audio
- Skippable en deux phases : AbrÃ¨ge texte et vidÃ©os email avec audio conservÃ© â†’ Coupe l'audio et passe Ã  la suite

### ğŸ“Œ Popup
- Pages d'infos scientifiques, juridiques ou narratives
- Navigation multi-pages

### ğŸ¯ Choice
- Influence directe du joueur sur le dÃ©roulÃ© du scÃ©nario (embranchements conditionnels)
- Filtrage dynamique des choix selon flags (choix prÃ©cÃ©dents et points des diffÃ©rentes fins)

### ğŸ”« Mission
- Vue TPS, contrÃ´le du joueur, navigation dans l'environnement
- Triggers sÃ©quentiels â†’ progression
- Tutoriel de prise en main
- Skippable Ã  tout moment

## ğŸ•¹ï¸ AccessibilitÃ© & ContrÃ´les

### ğŸ’» Clavier & Interface
- WASD / flÃ¨ches / joystick virtuel (mobile) â†’ DÃ©placement du joueur
- Espace â†’ Skipper dialogues, vidÃ©os, popups
- Ã‰chap â†’ Pause

### â™¿ AccessibilitÃ© prÃ©vue (roadmap)
- Navigation tab complÃ¨te
- Missions entiÃ¨rement au clavier
- CompatibilitÃ© lecteurs d'Ã©cran (Unity + HTML overlay)

## âš™ï¸ Build & DÃ©ploiement

### PrÃ©-requis
- Unity 2022.3 LTS
- WebGL Build Support
- Addressables

### Ã‰tapes
1. VÃ©rification des Addressables (prefabs, groupes)
2. Nettoyage cache
3. Compilation par chapitre avec groupe partagÃ© (Duplicate Assets Isolation)
4. ComboBuild WebGL DiskSizeLTO + DXT / ASTC depuis **_Game Build Menu/Dual Build_**

### Optimisations
- Chargements asynchrones
- Cache CDN Cloudflare
- Profiling CPU/GPU

## ğŸ“Š Analytics
- Funnel de progression sur Unity Analytics
- Suivi par noeuds de scÃ©nario et flags
- Formulaire de satisfaction connectÃ© Ã  Framaforms
- Export automatisÃ© (Python/Selenium)

## ğŸ§± Design Patterns
- Observer : Signaux / UI / transitions
- State : Navigation entre nÅ“uds
- Command : ContrÃ´les joueurs
- Factory : CrÃ©ation des actions
- Strategy : Logic mÃ©tiers action managers

## âœ… Plateformes cibles
Navigateurs web desktop et mobile (Android 13+ / iOS 15+) supportant WebGL 2.0

## ğŸ‘¥ CrÃ©dits
- DÃ©veloppement Unity : [Romaric Beltran](https://www.linkedin.com/in/romaric-beltran/)
- IngÃ©nierie pÃ©dagogique : [Diana Portela](https://www.linkedin.com/in/diana-portela/)
- Partenariat : [EndoFrance](https://endofrance.org/)

## ğŸ“‘ Annexes Techniques

Ã€ consulter sur [Mermaid Live Editor](https://mermaid.live/)

### Diagrammes d'Architecture

```mermaid
classDiagram
    class IActionManager {
        <<interface>>
        +OnNodeCompleted event
        +nextScenarioNodeName string
        +activateBackToMissionPOV bool
        +LoadData(BaseAction)
        +StartAction()
        +EndAction()
    }
    
    class BaseActionManager~T~ {
        <<abstract>>
        +OnNodeCompleted event
        +nextScenarioNodeName string
        +activateBackToMissionPOV bool
        #currentAction T
        -loadingNextNode bool
        +LoadData(BaseAction)
        +LoadData(T)
        +StartAction()
        +EndAction()
        #OnNodeCompletedHandler()
    }
    
    class PopupActionManager {
        -popupCanvas GameObject
        -mainText TextMeshProUGUI
        -sourceText TextMeshProUGUI
        -nextButton Button
        -currentPageIndex int
        -skippable bool
        +LoadData(PopupAction)
        +StartAction()
        +EndAction()
        #OnNextPage()
        #UpdatePageDisplay()
    }
    
    class ChoiceActionManager {
        -actionCanvas GameObject
        -actionButtons List~GameObject~
        -validChoices List~Choice~
        +LoadData(ChoiceAction)
        +StartAction()
        +EndAction()
        #OnActionChoice(Choice)
        #FilterValidChoices(List~Choice~)
    }

    class DialogueActionManager {
        -dialogueCanvas GameObject
        -characterImage Image
        -nameText TextMeshProUGUI
        -dialogueText TextMeshProUGUI
        -skipButton Button
        -sentences List~Sentence~
        -indexSentence int
        -isTyping bool
        -isAudioPlaying bool
        -skippable bool
        +LoadData(DialogueAction)
        +StartAction()
        +EndAction()
        #DisplayNextSentence()
        #TypeSentence(string)
        #PlayAudio(AudioClip)
        #SkipSentence()
    }

    class MissionActionManager {
        -missionCanvas GameObject
        -shadowBackground GameObject
        -missionBox GameObject
        -missionTitle TextMeshProUGUI
        -missionText TextMeshProUGUI
        -missionSkip Button
        -acceptButton Button
        -currentTargetMissions List~TargetMission~
        -activatedTriggers HashSet~TargetMission~
        -targetMissionIndex int
        -missionSkippable bool
        +LoadData(MissionAction)
        +StartAction()
        +EndAction()
        +OnTriggerActivated(TargetMission)
        +SkipMission()
        #AcceptMission()
        #StartTuto()
        #ContinueTuto()
        #EndTuto()
    }
    
    IActionManager <|.. BaseActionManager
    BaseActionManager <|-- PopupActionManager
    BaseActionManager <|-- ChoiceActionManager
    BaseActionManager <|-- DialogueActionManager
    BaseActionManager <|-- MissionActionManager
```

### Flux de Gestion des NÅ“uds

```mermaid
sequenceDiagram
    participant TM as TimelineManager
    participant AM as ActionManager
    participant TL as Timeline
    participant UI as UI System

    TM->>AM: LoadActionManager(manager, action)
    AM->>AM: LoadData(action)
    TM->>TL: Play Timeline Clip
    TL->>AM: Signal StartAction
    AM->>UI: Display UI
    UI->>AM: User Interactions
    AM->>TM: EndAction OnNodeCompleted
    TM->>TM: PlayNextScenarioNode
```

### Gestion des Ã‰tats Mission

```mermaid
stateDiagram-v2
    [*] --> Mission
    Mission --> Dialogue
    Mission --> Choice
    Mission --> Popup
    Dialogue --> Mission
    Choice --> Mission
    Popup --> Mission
    Mission --> [*]
```
